<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multitasking Game</title>
    <script>
        // intro.html을 먼저 보여주기 위한 체크
        if (!sessionStorage.getItem('introShown')) {
            window.location.href = 'intro.html';
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://4pl67mv56j.execute-api.ap-northeast-2.amazonaws.com">
<link rel="stylesheet" href="https://4pl67mv56j.execute-api.ap-northeast-2.amazonaws.com/v1/api/css/drop_fontstream_css/?sid=gAAAAABpEtwWUmmMvQ93GGgVQi72HQ36TJMa9UETk_SqQIehtEZfz63ied3JUsZNRZKc_FflOdVbbbeRMTv7DPO4Kh4KFXxwdDyYlq4rxojd8vJIenL8HYjy52u6bL6a3kNDVqlRczbErQLyZmxmV3vFxO2PW5Ysb0p1tzGdvVBEyecC4h1RLmf4DwjASDMfotfjWZ90wEjXYBHFDLApPsHvfIOcblQhtEGLNjpLuF7JnYdrfOgus9a_USxRF5gaLJRTonv343Rh" charset="utf-8" referrerpolicy="origin"></link>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 메인 화면 -->
    <div class="main-screen" id="mainContainer">
        <div class="intro-text-container" id="introTextContainer" style="display: none;">
            <p class="intro-text" id="introText"></p>
            <button class="start-btn" id="startBtn" onclick="enterGames()">업무 시작
            </button>
        </div>
    </div>

    <!-- 게임들이 쌓여있는 영역 (처음에는 숨김) -->
    <div class="games-wrapper" id="gamesWrapper" style="display: none;">
        <!-- 타이머 -->
        <div class="timer-container" id="timerContainer">
            <div class="timer-text" id="timerText">00:01:10</div>
        </div>
        <!-- 시간 종료 모달 -->
        <div class="timer-end-modal" id="timerEndModal" style="display: none;">
            <div class="timer-end-modal-content">
                <p class="timer-end-text">한번에 여러가지 일을 해보니 어떠신가요?</p>
            </div>
            <button class="restart-btn" id="restartBtn" onclick="restartGame()" style="display: none;">다시 체험하기</button>
        </div>
        <!-- 게임 1 -->
        <div class="game-layer" id="game1">
            <div class="game-window" id="gameWindow1">
                <div class="window-header" id="windowHeader1">
                    <span class="window-title">TASK 1 메일 보내기</span>
                    <span class="task-complete" id="taskComplete" style="display: none;">업무완료</span>
                </div>
                <div class="window-content">
                    <div class="game-area" id="gameArea">
                        <div class="email-form">
                            <div class="email-header">
                                <div class="email-fields">
                                    <div class="email-field">
                                        <label>TO</label>
                                        <input type="text" id="emailTo" placeholder="">
                                    </div>
                                    <div class="email-field">
                                        <label>SUBJECT</label>
                                        <input type="text" id="emailSubject" placeholder="">
                                    </div>
                                </div>
                                <div class="email-options">
                                    <span class="cc-bcc">Cc Bcc</span>
                                </div>
                            </div>
                            <div class="email-body">
                                <textarea id="emailBody" placeholder=""></textarea>
                            </div>
                            <div class="email-footer">
                                <button class="send-btn" onclick="sendEmail()">Send</button>
                                <div class="email-actions">
                                    <button class="action-icon" title="삭제">🗑️</button>
                                    <button class="action-icon" title="더보기">⋮</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 알림 창 (게임 설명) -->
        <div class="info-panel" id="infoPanel">
            <div class="info-header">
                <span class="info-title">NOTICE 1</span>
                <button class="minimize-btn" onclick="toggleInfoPanel()">_</button>
            </div>
            <div class="info-content" id="infoContent">
                <div class="notification-item">
                    <p class="notification-message">원문을 참고하여 메일을 정확하게 입력하고 보내기 버튼을 누르세요.</p>
                    <a href="#" class="view-original" onclick="openOriginalModal(event)">[원문보기]</a>
                </div>
            </div>
        </div>
        
        <!-- 원문 모달 -->
        <div class="original-modal" id="originalModal" style="display: none;">
            <div class="original-modal-content" id="originalModalContent">
                <div class="original-modal-header" id="originalModalHeader">
                    <h3>[원문]</h3>
                    <button class="original-modal-close" onclick="closeOriginalModal()">×</button>
                </div>
                <div class="original-modal-body" id="originalModalBody">
                </div>
            </div>
        </div>
        
        <!-- 게임 2는 task2.html에서 로드 -->
        <div id="task2Container"></div>
        
        <!-- 게임 3는 task3.html에서 로드 -->
        <div id="task3Container"></div>
        
        <!-- 게임 4는 task4.html에서 로드 -->
        <div id="task4Container"></div>
        
        <!-- 게임 5는 task5.html에서 로드 -->
        <div id="task5Container"></div>
    </div>

    <script src="game1.js"></script>
    <script>
        // 게임 윈도우 z-index 관리
        let windowZIndex = 10;
        
        function bringWindowToFront(windowId) {
            const window = document.getElementById(windowId);
            if (window) {
                windowZIndex += 1;
                window.style.zIndex = windowZIndex;
            }
        }
        
        function enterGames() {
            // 메인 화면 숨기기
            document.getElementById('mainContainer').style.display = 'none';
            // 게임 영역 보이기
            document.getElementById('gamesWrapper').style.display = 'block';
            
            // 첫 번째 게임 윈도우를 가장 앞으로
            setTimeout(function() {
                bringWindowToFront('gameWindow1');
            }, 100);
            
            // 타이머 시작
            startTimer();
            
            // 알림 창 1 드래그 기능 초기화
            initInfoPanelDrag('infoPanel', 'infoPanel');
            // 알림창 1의 초기 right 값 저장
            setTimeout(function() {
                const panel1 = document.getElementById('infoPanel');
                if (panel1) {
                    const computedStyle = window.getComputedStyle(panel1);
                    if (computedStyle.right !== 'auto') {
                        panel1.dataset.originalRight = computedStyle.right;
                    } else {
                        panel1.dataset.originalRight = '20px';
                    }
                    
                    // NOTICE 1 생성 시 사운드 재생
                    const audio = new Audio('note.mp3');
                    audio.volume = 0.15;
                    audio.play().catch(e => {
                        console.log('Audio play failed:', e);
                    });
                }
            }, 50);
            
            // 7초 후 게임 2 로드
            setTimeout(function() {
                loadTask2();
            }, 7000);
        }
        
        function initInfoPanelDrag(panelId, headerSelector) {
            const panel = document.getElementById(panelId);
            if (!panel) return;
            
            const header = panel.querySelector('.info-header');
            if (!header) return;
            
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            // 알림 창의 초기 위치 설정
            const rect = panel.getBoundingClientRect();
            const computedStyle = window.getComputedStyle(panel);
            
            // right 속성이 설정되어 있으면 left로 변환
            if (computedStyle.right !== 'auto' && computedStyle.left === 'auto') {
                const rightValue = parseInt(computedStyle.right) || 20;
                xOffset = window.innerWidth - panel.offsetWidth - rightValue;
            } else {
                xOffset = rect.left;
            }
            yOffset = rect.top;
            
            // 초기 위치 설정
            setTranslate(xOffset, yOffset, panel);

            header.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            header.addEventListener('touchstart', dragStartTouch);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', dragEnd);

            function dragStart(e) {
                // minimize 버튼 클릭 시 드래그 방지
                if (e.target.classList.contains('minimize-btn')) {
                    return;
                }
                
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                isDragging = true;
                panel.classList.add('dragging');
            }

            function dragStartTouch(e) {
                if (e.target.classList.contains('minimize-btn')) {
                    return;
                }
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
                isDragging = true;
                panel.classList.add('dragging');
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - panel.offsetWidth;
                    const maxY = window.innerHeight - panel.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, panel);
                }
            }

            function dragTouch(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - panel.offsetWidth;
                    const maxY = window.innerHeight - panel.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, panel);
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                panel.classList.remove('dragging');
            }

            function setTranslate(xPos, yPos, el) {
                el.style.left = xPos + 'px';
                el.style.top = yPos + 'px';
                el.style.transform = 'none';
                el.style.right = 'auto';
            }
        }
        
        function loadTask2() {
            // gameWindow1의 현재 위치 저장 (CSS 로드 전)
            const gameWindow1 = document.getElementById('gameWindow1');
            let savedPosition1 = null;
            if (gameWindow1) {
                const rect = gameWindow1.getBoundingClientRect();
                savedPosition1 = {
                    left: rect.left,
                    top: rect.top,
                    hasCustomPosition: gameWindow1.style.left || gameWindow1.style.top
                };
            }
            
            // CSS 로드 (캐시 방지)
            const existingLink = document.querySelector('link[href*="task2.css"]');
            if (existingLink) {
                existingLink.remove();
            }
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'task2.css?' + new Date().getTime();
            
            // CSS 로드 완료 후 위치 복원
            link.onload = function() {
                if (gameWindow1 && savedPosition1) {
                    gameWindow1.style.left = savedPosition1.left + 'px';
                    gameWindow1.style.top = savedPosition1.top + 'px';
                    gameWindow1.style.transform = 'none';
                }
            };
            document.head.appendChild(link);
            
            fetch('task2.html?' + new Date().getTime(), { cache: 'no-store' })
                .then(response => response.text())
                .then(html => {
                    document.getElementById('task2Container').innerHTML = html;
                    
                    // CSS 로드가 완료되지 않았을 경우를 대비해 추가 복원
                    setTimeout(function() {
                        if (gameWindow1 && savedPosition1) {
                            gameWindow1.style.left = savedPosition1.left + 'px';
                            gameWindow1.style.top = savedPosition1.top + 'px';
                            gameWindow1.style.transform = 'none';
                        }
                    }, 100);
                    
                    // 게임 2 윈도우를 가장 앞으로
                    setTimeout(function() {
                        bringWindowToFront('gameWindow2');
                    }, 100);
                    // 게임 2 드래그 기능 초기화
                    initGame2Drag();
                    // 캘린더 초기화
                    setTimeout(function() {
                        initCalendar();
                    }, 200);
                    // 알림 창 2 드래그 기능 초기화 (DOM이 완전히 렌더링된 후)
                    setTimeout(function() {
                        const panel2 = document.getElementById('infoPanel2');
                        if (panel2) {
                            initInfoPanelDrag('infoPanel2', 'infoPanel2');
                            // 알림창 2의 초기 right 값 저장
                            const computedStyle = window.getComputedStyle(panel2);
                            if (computedStyle.right !== 'auto') {
                                panel2.dataset.originalRight = computedStyle.right;
                            } else {
                                panel2.dataset.originalRight = '20px';
                            }
                            
                            // NOTICE 2 생성 시 사운드 재생
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                })
                .catch(error => {
                    console.error('게임 2 로드 실패:', error);
                    // fetch 실패 시 직접 HTML 삽입
                    const fallbackHTML = `
                        <div class="game-layer" id="game2">
                            <div class="game-window" id="gameWindow2">
                                <div class="window-header" id="windowHeader2">
                                    <span class="window-title">TASK 2 회의 날짜 선택하기</span>
                                    <span class="task-complete" id="taskComplete2" style="display: none;">업무완료</span>
                                </div>
                                <div class="window-content">
                                    <div class="game-area" id="gameArea2">
                                        <div class="calendar-container">
                                            <div class="calendar-header">
                                                <button class="calendar-nav-btn" id="prevMonth">‹</button>
                                                <h3 class="calendar-title" id="calendarTitle">2025년 1월</h3>
                                                <button class="calendar-nav-btn" id="nextMonth">›</button>
                                            </div>
                                            <div class="calendar-weekdays">
                                                <div class="weekday">일</div>
                                                <div class="weekday">월</div>
                                                <div class="weekday">화</div>
                                                <div class="weekday">수</div>
                                                <div class="weekday">목</div>
                                                <div class="weekday">금</div>
                                                <div class="weekday">토</div>
                                            </div>
                                            <div class="calendar-days" id="calendarDays">
                                                <!-- 날짜들이 여기에 동적으로 생성됩니다 -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-panel" id="infoPanel2">
                            <div class="info-header">
                                <span class="info-title">NOTICE 2</span>
                                <button class="minimize-btn" onclick="toggleInfoPanel2()">_</button>
                            </div>
                            <div class="info-content" id="infoContent2">
                                <div class="notification-item">
                                    <p class="notification-message">TASK 1 메일에서의 회의 날짜를 캘린더에서 클릭하세요.</p>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('task2Container').innerHTML = fallbackHTML;
                    initGame2Drag();
                    // 캘린더 초기화
                    setTimeout(function() {
                        initCalendar();
                    }, 200);
                    // 알림 창 2 드래그 기능 초기화
                    setTimeout(function() {
                        const panel2 = document.getElementById('infoPanel2');
                        if (panel2) {
                            initInfoPanelDrag('infoPanel2', 'infoPanel2');
                            // 알림창 2의 초기 right 값 저장
                            const computedStyle = window.getComputedStyle(panel2);
                            if (computedStyle.right !== 'auto') {
                                panel2.dataset.originalRight = computedStyle.right;
                            } else {
                                panel2.dataset.originalRight = '20px';
                            }
                            
                            // NOTICE 2 생성 시 사운드 재생 (fallback)
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                });
            
            // TASK 2 로드 후 7초 뒤에 TASK 3 로드
            setTimeout(function() {
                loadTask3();
            }, 7000);
        }
        
        function loadTask3() {
            // 기존 윈도우들의 현재 위치 저장
            const savedPositions = {};
            ['gameWindow1', 'gameWindow2'].forEach(function(windowId) {
                const window = document.getElementById(windowId);
                if (window) {
                    const rect = window.getBoundingClientRect();
                    savedPositions[windowId] = {
                        left: rect.left,
                        top: rect.top
                    };
                }
            });
            
            // CSS 로드 (캐시 방지)
            const existingLink = document.querySelector('link[href*="task3.css"]');
            if (existingLink) {
                existingLink.remove();
            }
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'task3.css?' + new Date().getTime();
            
            // CSS 로드 완료 후 위치 복원
            link.onload = function() {
                Object.keys(savedPositions).forEach(function(windowId) {
                    const window = document.getElementById(windowId);
                    const pos = savedPositions[windowId];
                    if (window && pos) {
                        window.style.left = pos.left + 'px';
                        window.style.top = pos.top + 'px';
                        window.style.transform = 'none';
                    }
                });
            };
            document.head.appendChild(link);
            
            fetch('task3.html?' + new Date().getTime(), { cache: 'no-store' })
                .then(response => response.text())
                .then(html => {
                    document.getElementById('task3Container').innerHTML = html;
                    
                    // CSS 로드가 완료되지 않았을 경우를 대비해 추가 복원
                    setTimeout(function() {
                        Object.keys(savedPositions).forEach(function(windowId) {
                            const window = document.getElementById(windowId);
                            const pos = savedPositions[windowId];
                            if (window && pos) {
                                window.style.left = pos.left + 'px';
                                window.style.top = pos.top + 'px';
                                window.style.transform = 'none';
                            }
                        });
                    }, 100);
                    
                    // 게임 3 윈도우를 가장 앞으로
                    setTimeout(function() {
                        bringWindowToFront('gameWindow3');
                    }, 100);
                    // 게임 3 드래그 기능 초기화
                    initGame3Drag();
                    // 알림 창 3 드래그 기능 초기화 (DOM이 완전히 렌더링된 후)
                    setTimeout(function() {
                        const panel3 = document.getElementById('infoPanel3');
                        if (panel3) {
                            initInfoPanelDrag('infoPanel3', 'infoPanel3');
                            // 알림창 3의 초기 right 값 저장
                            const computedStyle = window.getComputedStyle(panel3);
                            if (computedStyle.right !== 'auto') {
                                panel3.dataset.originalRight = computedStyle.right;
                            } else {
                                panel3.dataset.originalRight = '20px';
                            }
                            
                            // NOTICE 3 생성 시 사운드 재생
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                    
                    // TASK 3 완료 버튼 이벤트 리스너 추가
                    setTimeout(function() {
                        const completeBtn = document.getElementById('completeTask3Btn');
                        if (completeBtn) {
                            completeBtn.addEventListener('click', completeTask3);
                        }
                    }, 200);
                    
                    // TASK 4 로드 (7초 후)
                    setTimeout(function() {
                        loadTask4();
                    }, 7000);
                })
                .catch(error => {
                    console.error('게임 3 로드 실패:', error);
                    // fetch 실패 시 직접 HTML 삽입
                    const fallbackHTML = `
                        <div class="game-layer" id="game3">
                            <div class="game-window" id="gameWindow3">
                                <div class="window-header" id="windowHeader3">
                                    <span class="window-title">TASK 3 오탈자 수정하기</span>
                                    <span class="task-complete" id="taskComplete3" style="display: none;">업무완료</span>
                                </div>
                                <div class="window-content">
                                    <div class="game-area" id="gameArea3">
                                        <div style="padding: 20px; font-family: 'Roboto', 'Apple SD Gothic Neo', 'Malgun Gothic', '맑은 고딕', sans-serif; font-size: 17px; line-height: 1.8; color: #333;">
                                            <div id="task3Text" contenteditable="true" style="margin-bottom: 30px; min-height: 150px; border: 1px solid #7d00ff; padding: 15px; background: white; white-space: pre-wrap;">금주 마케팅 내용을 정리하엿습니다.

새로운 고객 층 반응이 예쌍보다 긍정적이엿으며,

추가 분석 자료는 내일 중으로 공유드리갰습니다.</div>
                                            <button id="completeTask3Btn" onclick="completeTask3()" class="send-btn">수정 완료</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-panel" id="infoPanel3">
                            <div class="info-header">
                                <span class="info-title">NOTICE 3</span>
                                <button class="minimize-btn" onclick="toggleInfoPanel3()">_</button>
                            </div>
                            <div class="info-content" id="infoContent3">
                                <div class="notification-item">
                                    <p class="notification-message">보고서에서 잘못된 철자를 모두 수정하세요. 수정이 완료되면 수정 완료 버튼을 누르세요.</p>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('task3Container').innerHTML = fallbackHTML;
                    initGame3Drag();
                    // 알림 창 3 드래그 기능 초기화
                    setTimeout(function() {
                        const panel3 = document.getElementById('infoPanel3');
                        if (panel3) {
                            initInfoPanelDrag('infoPanel3', 'infoPanel3');
                            // 알림창 3의 초기 right 값 저장
                            const computedStyle = window.getComputedStyle(panel3);
                            if (computedStyle.right !== 'auto') {
                                panel3.dataset.originalRight = computedStyle.right;
                            } else {
                                panel3.dataset.originalRight = '20px';
                            }
                            
                            // NOTICE 3 생성 시 사운드 재생
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                    
                    // TASK 3 완료 버튼 이벤트 리스너 추가
                    setTimeout(function() {
                        const completeBtn = document.getElementById('completeTask3Btn');
                        if (completeBtn) {
                            completeBtn.addEventListener('click', completeTask3);
                        }
                    }, 200);
                    
                    // TASK 4 로드 (7초 후)
                    setTimeout(function() {
                        loadTask4();
                    }, 7000);
                });
        }
        
        function loadTask4() {
            // 기존 윈도우들의 현재 위치 저장
            const savedPositions = {};
            ['gameWindow1', 'gameWindow2', 'gameWindow3'].forEach(function(windowId) {
                const window = document.getElementById(windowId);
                if (window) {
                    const rect = window.getBoundingClientRect();
                    savedPositions[windowId] = {
                        left: rect.left,
                        top: rect.top
                    };
                }
            });
            
            // CSS 로드 (캐시 방지)
            const existingLink = document.querySelector('link[href*="task4.css"]');
            if (existingLink) {
                existingLink.remove();
            }
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'task4.css?' + new Date().getTime();
            
            // CSS 로드 완료 후 위치 복원
            link.onload = function() {
                Object.keys(savedPositions).forEach(function(windowId) {
                    const window = document.getElementById(windowId);
                    const pos = savedPositions[windowId];
                    if (window && pos) {
                        window.style.left = pos.left + 'px';
                        window.style.top = pos.top + 'px';
                        window.style.transform = 'none';
                    }
                });
            };
            document.head.appendChild(link);
            
            fetch('task4.html?' + new Date().getTime(), { cache: 'no-store' })
                .then(response => response.text())
                .then(html => {
                    document.getElementById('task4Container').innerHTML = html;
                    
                    // CSS 로드가 완료되지 않았을 경우를 대비해 추가 복원
                    setTimeout(function() {
                        Object.keys(savedPositions).forEach(function(windowId) {
                            const window = document.getElementById(windowId);
                            const pos = savedPositions[windowId];
                            if (window && pos) {
                                window.style.left = pos.left + 'px';
                                window.style.top = pos.top + 'px';
                                window.style.transform = 'none';
                            }
                        });
                    }, 100);
                    
                    // 게임 4 윈도우를 가장 앞으로
                    setTimeout(function() {
                        bringWindowToFront('gameWindow4');
                    }, 100);
                    // 게임 4 드래그 기능 초기화
                    initGame4Drag();
                    // 파일 순서 랜덤 섞기
                    setTimeout(function() {
                        shuffleFileItems();
                        // 파일 더블클릭 기능 초기화
                        initFileDoubleClick();
                    }, 200);
                    // 알림 창 4 드래그 기능 초기화 (DOM이 완전히 렌더링된 후)
                    setTimeout(function() {
                        const panel4 = document.getElementById('infoPanel4');
                        if (panel4) {
                            initInfoPanelDrag('infoPanel4', 'infoPanel4');
                            // 알림창 4의 초기 right 값 저장
                            const computedStyle = window.getComputedStyle(panel4);
                            if (computedStyle.right !== 'auto') {
                                panel4.dataset.originalRight = computedStyle.right;
                            } else {
                                panel4.dataset.originalRight = '20px';
                            }
                            
                            // NOTICE 4 생성 시 사운드 재생
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                    
                    // TASK 5 로드 (7초 후)
                    setTimeout(function() {
                        loadTask5();
                    }, 7000);
                })
                .catch(error => {
                    console.error('게임 4 로드 실패:', error);
                    // fetch 실패 시 직접 HTML 삽입
                    const fallbackHTML = `
                        <div class="game-layer" id="game4">
                            <div class="game-window" id="gameWindow4">
                                <div class="window-header" id="windowHeader4">
                                    <span class="window-title">TASK 4 파일 선택하기</span>
                                    <span class="task-complete" id="taskComplete4" style="display: none;">업무완료</span>
                                </div>
                                <div class="window-content">
                                    <div class="game-area" id="gameArea4">
                                        <div class="file-grid-container">
                                            <div class="file-item" data-file="file1">
                                                <img src="file.png" alt="file1" class="file-image">
                                                <div class="file-name">A_v2.png</div>
                                            </div>
                                            <div class="file-item" data-file="file2">
                                                <img src="file.png" alt="file2" class="file-image">
                                                <div class="file-name">A_v2_final.png</div>
                                            </div>
                                            <div class="file-item" data-file="file3">
                                                <img src="file.png" alt="file3" class="file-image">
                                                <div class="file-name">A_v3.png</div>
                                            </div>
                                            <div class="file-item" data-file="file4">
                                                <img src="file.png" alt="file4" class="file-image">
                                                <div class="file-name">A_v3_final.png</div>
                                            </div>
                                            <div class="file-item" data-file="file5">
                                                <img src="file.png" alt="file5" class="file-image">
                                                <div class="file-name">A_v3_final_v2.png</div>
                                            </div>
                                            <div class="file-item" data-file="file6">
                                                <img src="file.png" alt="file6" class="file-image">
                                                <div class="file-name">A_v3_final_final_final.png</div>
                                            </div>
                                            <div class="file-item" data-file="file7">
                                                <img src="file.png" alt="file7" class="file-image">
                                                <div class="file-name">A_v3_final_final_final.jpg</div>
                                            </div>
                                            <div class="file-item" data-file="file8">
                                                <img src="file.png" alt="file8" class="file-image">
                                                <div class="file-name">A_v3_final_final_copy.png</div>
                                            </div>
                                            <div class="file-item" data-file="file9">
                                                <img src="file.png" alt="file9" class="file-image">
                                                <div class="file-name">A_draft_v1.png</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-panel" id="infoPanel4">
                            <div class="info-header">
                                <span class="info-title">NOTICE 4</span>
                                <button class="minimize-btn" onclick="toggleInfoPanel4()">_</button>
                            </div>
                            <div class="info-content" id="infoContent4">
                                <div class="notification-item">
                                    <p class="notification-message">제출해야 할 최종 파일명을 확인하세요.<br>이번 제출 대상 파일: A_v3_final_final_final.png<br>올바른 파일을 더블클릭하여 제출해주세요.</p>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('task4Container').innerHTML = fallbackHTML;
                    initGame4Drag();
                    // 파일 순서 랜덤 섞기
                    setTimeout(function() {
                        shuffleFileItems();
                        // 파일 더블클릭 기능 초기화
                        initFileDoubleClick();
                    }, 200);
                    // 알림 창 4 드래그 기능 초기화
                    setTimeout(function() {
                        const panel4 = document.getElementById('infoPanel4');
                        if (panel4) {
                            initInfoPanelDrag('infoPanel4', 'infoPanel4');
                            // 알림창 4의 초기 right 값 저장
                            const computedStyle = window.getComputedStyle(panel4);
                            if (computedStyle.right !== 'auto') {
                                panel4.dataset.originalRight = computedStyle.right;
                            } else {
                                panel4.dataset.originalRight = '20px';
                            }
                            
                            // NOTICE 4 생성 시 사운드 재생
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                    
                    // TASK 5 로드 (7초 후)
                    setTimeout(function() {
                        loadTask5();
                    }, 7000);
                });
        }
        
        function loadTask5() {
            // 기존 윈도우들의 현재 위치 저장
            const savedPositions = {};
            ['gameWindow1', 'gameWindow2', 'gameWindow3', 'gameWindow4'].forEach(function(windowId) {
                const window = document.getElementById(windowId);
                if (window) {
                    const rect = window.getBoundingClientRect();
                    savedPositions[windowId] = {
                        left: rect.left,
                        top: rect.top
                    };
                }
            });
            
            // CSS 로드 (캐시 방지)
            const existingLink = document.querySelector('link[href*="task5.css"]');
            if (existingLink) {
                existingLink.remove();
            }
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'task5.css?' + new Date().getTime();
            
            // CSS 로드 완료 후 위치 복원
            link.onload = function() {
                Object.keys(savedPositions).forEach(function(windowId) {
                    const window = document.getElementById(windowId);
                    const pos = savedPositions[windowId];
                    if (window && pos) {
                        window.style.left = pos.left + 'px';
                        window.style.top = pos.top + 'px';
                        window.style.transform = 'none';
                    }
                });
            };
            document.head.appendChild(link);
            
            fetch('task5.html?' + new Date().getTime(), { cache: 'no-store' })
                .then(response => response.text())
                .then(html => {
                    document.getElementById('task5Container').innerHTML = html;
                    
                    // CSS 로드가 완료되지 않았을 경우를 대비해 추가 복원
                    setTimeout(function() {
                        Object.keys(savedPositions).forEach(function(windowId) {
                            const window = document.getElementById(windowId);
                            const pos = savedPositions[windowId];
                            if (window && pos) {
                                window.style.left = pos.left + 'px';
                                window.style.top = pos.top + 'px';
                                window.style.transform = 'none';
                            }
                        });
                    }, 100);
                    
                    // 게임 5 윈도우를 가장 앞으로
                    setTimeout(function() {
                        bringWindowToFront('gameWindow5');
                    }, 100);
                    // 게임 5 드래그 기능 초기화
                    initGame5Drag();
                    // 슬라이드 드래그 앤 드롭 기능 초기화
                    setTimeout(function() {
                        initSlideDragDrop();
                        // 완료 버튼 이벤트 리스너 추가
                        const completeBtn = document.getElementById('completeTask5Btn');
                        if (completeBtn) {
                            completeBtn.addEventListener('click', completeTask5);
                        }
                    }, 200);
                    // 알림 창 5 드래그 기능 초기화 (DOM이 완전히 렌더링된 후)
                    setTimeout(function() {
                        const panel5 = document.getElementById('infoPanel5');
                        if (panel5) {
                            // infoPanel5를 왼쪽에 위치하도록 설정
                            panel5.style.left = '20px';
                            panel5.style.right = 'auto';
                            initInfoPanelDrag('infoPanel5', 'infoPanel5');
                            // 알림창 5의 초기 left 값 저장
                            panel5.dataset.originalLeft = '20px';
                            panel5.dataset.originalRight = 'auto';
                            
                            // NOTICE 5 생성 시 사운드 재생
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                })
                .catch(error => {
                    console.error('게임 5 로드 실패:', error);
                    // fetch 실패 시 직접 HTML 삽입
                    const fallbackHTML = `
                        <div class="game-layer" id="game5">
                            <div class="game-window" id="gameWindow5">
                                <div class="window-header" id="windowHeader5">
                                    <span class="window-title">TASK 5 발표 자료 재배치하기</span>
                                    <span class="task-complete" id="taskComplete5" style="display: none;">업무완료</span>
                                </div>
                                <div class="window-content">
                                    <div class="game-area" id="gameArea5">
                                        <div class="slide-container" id="slideContainer">
                                            <div class="slide-item" data-order="1">
                                                <div class="slide-number">1</div>
                                                <div class="slide-title">표지 — Project A Overview</div>
                                            </div>
                                            <div class="slide-item" data-order="2">
                                                <div class="slide-number">2</div>
                                                <div class="slide-title">목차 — Agenda</div>
                                            </div>
                                            <div class="slide-item" data-order="3">
                                                <div class="slide-number">3</div>
                                                <div class="slide-title">분석 결과 — Key Findings</div>
                                            </div>
                                            <div class="slide-item" data-order="4">
                                                <div class="slide-number">4</div>
                                                <div class="slide-title">개선안 — Proposed Solution</div>
                                            </div>
                                            <div class="slide-item" data-order="5">
                                                <div class="slide-number">5</div>
                                                <div class="slide-title">마무리 — Next Steps & Q/A</div>
                                            </div>
                                        </div>
                                        <button id="completeTask5Btn" onclick="completeTask5()" class="send-btn">완료</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-panel" id="infoPanel5">
                            <div class="info-header">
                                <span class="info-title">NOTICE 5</span>
                                <button class="minimize-btn" onclick="toggleInfoPanel5()">_</button>
                            </div>
                            <div class="info-content" id="infoContent5">
                                <div class="notification-item">
                                    <p class="notification-message">발표 자료 슬라이드를 올바른 순서로 재배치해 발표 준비를 완료해주세요.<br>정답 순서:<br>표지 — Project A Overview<br>목차 — Agenda<br>분석 결과 — Key Findings<br>개선안 — Proposed Solution<br>마무리 — Next Steps & Q/A</p>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('task5Container').innerHTML = fallbackHTML;
                    initGame5Drag();
                    // 슬라이드 드래그 앤 드롭 기능 초기화
                    setTimeout(function() {
                        initSlideDragDrop();
                        // 완료 버튼 이벤트 리스너 추가
                        const completeBtn = document.getElementById('completeTask5Btn');
                        if (completeBtn) {
                            completeBtn.addEventListener('click', completeTask5);
                        }
                    }, 200);
                    // 알림 창 5 드래그 기능 초기화
                    setTimeout(function() {
                        const panel5 = document.getElementById('infoPanel5');
                        if (panel5) {
                            // infoPanel5를 왼쪽에 위치하도록 설정
                            panel5.style.left = '20px';
                            panel5.style.right = 'auto';
                            initInfoPanelDrag('infoPanel5', 'infoPanel5');
                            // 알림창 5의 초기 left 값 저장
                            panel5.dataset.originalLeft = '20px';
                            panel5.dataset.originalRight = 'auto';
                            
                            // NOTICE 5 생성 시 사운드 재생
                            const audio = new Audio('note.mp3');
                            audio.volume = 0.15;
                            audio.play().catch(e => {
                                console.log('Audio play failed:', e);
                            });
                        }
                    }, 200);
                });
        }
        
        function initGame3Drag() {
            const gameWindow = document.getElementById('gameWindow3');
            const windowHeader = document.getElementById('windowHeader3');
            
            if (!gameWindow || !windowHeader) return;
            
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            const rect = gameWindow.getBoundingClientRect();
            xOffset = rect.left;
            yOffset = rect.top;

            windowHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            windowHeader.addEventListener('touchstart', dragStartTouch);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', dragEnd);

            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                isDragging = true;
                bringWindowToFront('gameWindow3');
                gameWindow.classList.add('dragging');
            }

            function dragStartTouch(e) {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
                isDragging = true;
                bringWindowToFront('gameWindow3');
                gameWindow.classList.add('dragging');
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragTouch(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                gameWindow.classList.remove('dragging');
            }

            function setTranslate(xPos, yPos, el) {
                el.style.left = xPos + 'px';
                el.style.top = yPos + 'px';
                el.style.transform = 'none';
            }
        }
        
        function toggleInfoPanel3() {
            const panel = document.getElementById('infoPanel3');
            const content = document.getElementById('infoContent3');
            
            if (!panel) return;
            
            // 한번 닫혔으면 다시 열리지 않도록
            if (panel.dataset.closed === 'true') {
                return;
            }
            
            if (panel.classList.contains('minimized')) {
                panel.classList.remove('minimized');
                content.style.display = 'block';
                // right 속성 복원
                if (panel.dataset.originalRight) {
                    panel.style.right = panel.dataset.originalRight;
                    panel.style.left = 'auto';
                } else {
                    // 저장된 값이 없으면 기본값 사용
                    panel.style.right = '20px';
                    panel.style.left = 'auto';
                }
            } else {
                // 축소 - 오른쪽 위치 유지
                const computedStyle = window.getComputedStyle(panel);
                
                // originalRight가 없으면 현재 상태에서 저장
                if (!panel.dataset.originalRight) {
                    if (computedStyle.right !== 'auto') {
                        panel.dataset.originalRight = computedStyle.right;
                    } else if (computedStyle.left !== 'auto') {
                        // left를 right로 변환
                        const leftValue = parseInt(computedStyle.left) || 0;
                        const rightValue = window.innerWidth - leftValue - panel.offsetWidth;
                        panel.dataset.originalRight = rightValue + 'px';
                    } else {
                        panel.dataset.originalRight = '20px';
                    }
                }
                
                // right 속성 설정
                panel.style.right = panel.dataset.originalRight;
                panel.style.left = 'auto';
                panel.classList.add('minimized');
                content.style.display = 'none';
                // 닫힌 상태로 표시
                panel.dataset.closed = 'true';
            }
        }
        
        function toggleWindowCollapse3() {
            const gameWindow = document.getElementById('gameWindow3');
            const windowContent = gameWindow.querySelector('.window-content');
            const taskComplete = document.getElementById('taskComplete3');
            
            // 업무 완료 후에는 다시 열리지 않도록
            if (taskComplete && window.getComputedStyle(taskComplete).display !== 'none') {
                return;
            }
            
            if (gameWindow.classList.contains('collapsed')) {
                // 펼치기
                windowContent.style.display = 'flex';
                gameWindow.style.height = '400px';
                gameWindow.classList.remove('collapsed');
            } else {
                // 접기
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
            }
        }
        
        function completeTask3() {
            const task3Text = document.getElementById('task3Text');
            if (!task3Text) return;
            
            // 텍스트 내용 가져오기 (HTML 태그 제거)
            const textContent = task3Text.innerText || task3Text.textContent;
            
            // 정답 텍스트 (모든 오탈자 수정된 버전)
            const correctText = `금주 마케팅 내용을 정리하였습니다.

새로운 고객 층 반응이 예상보다 긍정적이었으며,

추가 분석 자료는 내일 중으로 공유드리겠습니다.`;
            
            // 텍스트 정규화 (줄바꿈, 공백 정규화)
            function normalizeText(text) {
                return text
                    .replace(/\r\n/g, '\n')
                    .replace(/\r/g, '\n')
                    .replace(/\n+/g, '\n')
                    .replace(/[ \t]+/g, ' ')
                    .trim();
            }
            
            const normalizedUserText = normalizeText(textContent);
            const normalizedCorrectText = normalizeText(correctText);
            
            // 오탈자 확인
            const hasError1 = textContent.includes('정리하엿습니다');
            const hasError2 = textContent.includes('예쌍보다');
            const hasError3 = textContent.includes('긍정적이엿으며');
            const hasError4 = textContent.includes('공유드리갰습니다');
            
            // 모든 오탈자가 수정되었는지 확인
            if (!hasError1 && !hasError2 && !hasError3 && !hasError4) {
                // 업무 완료 처리
                alert('업무완료');
                
                const gameWindow = document.getElementById('gameWindow3');
                const windowContent = gameWindow.querySelector('.window-content');
                const taskComplete = document.getElementById('taskComplete3');
                
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
                taskComplete.style.display = 'block';
                
                // 헤더 클릭 시 다시 펼치기
                const windowHeader = document.getElementById('windowHeader3');
                windowHeader.onclick = function(e) {
                    if (!windowHeader.classList.contains('dragging')) {
                        toggleWindowCollapse3();
                    }
                };
            } else {
                alert('모든 오탈자를 수정해주세요.');
            }
        }
        
        function initGame4Drag() {
            const gameWindow = document.getElementById('gameWindow4');
            const windowHeader = document.getElementById('windowHeader4');
            
            if (!gameWindow || !windowHeader) return;
            
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            const rect = gameWindow.getBoundingClientRect();
            xOffset = rect.left;
            yOffset = rect.top;

            windowHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            windowHeader.addEventListener('touchstart', dragStartTouch);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', dragEnd);

            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                isDragging = true;
                bringWindowToFront('gameWindow4');
                gameWindow.classList.add('dragging');
            }

            function dragStartTouch(e) {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
                isDragging = true;
                bringWindowToFront('gameWindow4');
                gameWindow.classList.add('dragging');
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragTouch(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                gameWindow.classList.remove('dragging');
            }

            function setTranslate(xPos, yPos, el) {
                el.style.left = xPos + 'px';
                el.style.top = yPos + 'px';
                el.style.transform = 'none';
            }
        }
        
        function toggleInfoPanel4() {
            const panel = document.getElementById('infoPanel4');
            const content = document.getElementById('infoContent4');
            
            if (!panel) return;
            
            // 한번 닫혔으면 다시 열리지 않도록
            if (panel.dataset.closed === 'true') {
                return;
            }
            
            if (panel.classList.contains('minimized')) {
                panel.classList.remove('minimized');
                content.style.display = 'block';
                // right 속성 복원
                if (panel.dataset.originalRight) {
                    panel.style.right = panel.dataset.originalRight;
                    panel.style.left = 'auto';
                } else {
                    // 저장된 값이 없으면 기본값 사용
                    panel.style.right = '20px';
                    panel.style.left = 'auto';
                }
            } else {
                // 축소 - 오른쪽 위치 유지
                const computedStyle = window.getComputedStyle(panel);
                
                // originalRight가 없으면 현재 상태에서 저장
                if (!panel.dataset.originalRight) {
                    if (computedStyle.right !== 'auto') {
                        panel.dataset.originalRight = computedStyle.right;
                    } else if (computedStyle.left !== 'auto') {
                        // left를 right로 변환
                        const leftValue = parseInt(computedStyle.left) || 0;
                        const rightValue = window.innerWidth - leftValue - panel.offsetWidth;
                        panel.dataset.originalRight = rightValue + 'px';
                    } else {
                        panel.dataset.originalRight = '20px';
                    }
                }
                
                // right 속성 설정
                panel.style.right = panel.dataset.originalRight;
                panel.style.left = 'auto';
                panel.classList.add('minimized');
                content.style.display = 'none';
                // 닫힌 상태로 표시
                panel.dataset.closed = 'true';
            }
        }
        
        function toggleWindowCollapse4() {
            const gameWindow = document.getElementById('gameWindow4');
            const windowContent = gameWindow.querySelector('.window-content');
            const taskComplete = document.getElementById('taskComplete4');
            
            // 업무 완료 후에는 다시 열리지 않도록
            if (taskComplete && window.getComputedStyle(taskComplete).display !== 'none') {
                return;
            }
            
            if (gameWindow.classList.contains('collapsed')) {
                // 펼치기
                windowContent.style.display = 'flex';
                gameWindow.style.height = '400px';
                gameWindow.classList.remove('collapsed');
            } else {
                // 접기
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
            }
        }
        
        
        // 파일 아이템 순서 랜덤 섞기
        function shuffleFileItems() {
            const fileGridContainer = document.querySelector('#gameArea4 .file-grid-container');
            if (!fileGridContainer) return;
            
            // 모든 파일 아이템을 배열로 가져오기
            const fileItems = Array.from(fileGridContainer.querySelectorAll('.file-item'));
            
            // Fisher-Yates 셔플 알고리즘
            for (let i = fileItems.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [fileItems[i], fileItems[j]] = [fileItems[j], fileItems[i]];
            }
            
            // 섞인 순서대로 다시 DOM에 추가
            fileItems.forEach(function(fileItem) {
                fileGridContainer.appendChild(fileItem);
            });
        }
        
        function initFileDoubleClick() {
            const fileItems = document.querySelectorAll('#gameArea4 .file-item');
            
            fileItems.forEach(function(fileItem) {
                // 더블클릭 이벤트 추가
                fileItem.addEventListener('dblclick', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const fileNameElement = fileItem.querySelector('.file-name');
                    if (!fileNameElement) {
                        console.log('File name element not found');
                        return;
                    }
                    
                    const fileName = fileNameElement.textContent.trim();
                    console.log('Double clicked file:', fileName); // 디버깅용
                    
                    // A_v3_final_final_final.png 파일인 경우 업무 완료
                    if (fileName === 'A_v3_final_final_final.png') {
                        console.log('Correct file! Completing task...');
                        completeTask4();
                    } else {
                        // 다른 파일인 경우
                        console.log('Wrong file!');
                        alert('올바르지 않은 파일입니다');
                    }
                });
            });
        }
        
        function initCalendar() {
            const calendarDays = document.getElementById('calendarDays');
            const calendarTitle = document.getElementById('calendarTitle');
            const prevBtn = document.getElementById('prevMonth');
            const nextBtn = document.getElementById('nextMonth');
            
            if (!calendarDays || !calendarTitle) return;
            
            let currentYear = 2025;
            let currentMonth = 0; // 1월 (0-based index)
            
            function renderCalendar(year, month) {
                calendarDays.innerHTML = '';
                
                // 해당 월의 첫 날과 마지막 날
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay()); // 주의 첫 날로
                
                // 6주 표시 (42일)
                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    
                    // 날짜 정보를 저장 (클로저 문제 방지)
                    const dateYear = date.getFullYear();
                    const dateMonth = date.getMonth();
                    const dateDay = date.getDate();
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = dateDay;
                    
                    // 다른 월의 날짜
                    if (dateMonth !== month) {
                        dayElement.classList.add('other-month');
                    }
                    
                    // 모든 날짜에 클릭 이벤트 추가
                    dayElement.addEventListener('click', function() {
                        // 12월 8일인 경우
                        if (dateYear === 2025 && dateMonth === 11 && dateDay === 8) {
                            completeTask2();
                        } else {
                            // 다른 날짜인 경우
                            alert('회의 날짜가 틀렸습니다');
                        }
                    });
                    
                    // 12월 8일인 경우 스타일 추가
                    if (dateYear === 2025 && dateMonth === 11 && dateDay === 8) {
                        dayElement.classList.add('target-date');
                    }
                    
                    calendarDays.appendChild(dayElement);
                }
                
                calendarTitle.textContent = `${year}년 ${month + 1}월`;
            }
            
            // 이전/다음 월 버튼
            if (prevBtn) {
                prevBtn.addEventListener('click', function() {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar(currentYear, currentMonth);
                });
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', function() {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar(currentYear, currentMonth);
                });
            }
            
            // 초기 렌더링
            renderCalendar(currentYear, currentMonth);
        }
        
        function completeTask2() {
            alert('업무완료');
            
            // 윈도우를 헤더만 남기고 접기
            const gameWindow = document.getElementById('gameWindow2');
            const windowContent = gameWindow.querySelector('.window-content');
            const taskComplete = document.getElementById('taskComplete2');
            
            windowContent.style.display = 'none';
            gameWindow.style.height = 'auto';
            gameWindow.classList.add('collapsed');
            taskComplete.style.display = 'block';
            
            // 헤더 클릭 시 다시 펼치기
            const windowHeader = document.getElementById('windowHeader2');
            windowHeader.onclick = function(e) {
                // 드래그 중이 아닐 때만 펼치기
                if (!windowHeader.classList.contains('dragging')) {
                    toggleWindowCollapse2();
                }
            };
        }
        
        function toggleWindowCollapse2() {
            const gameWindow = document.getElementById('gameWindow2');
            const windowContent = gameWindow.querySelector('.window-content');
            const taskComplete = document.getElementById('taskComplete2');
            
            // 업무 완료 후에는 다시 열리지 않도록
            if (taskComplete && window.getComputedStyle(taskComplete).display !== 'none') {
                return;
            }
            
            if (gameWindow.classList.contains('collapsed')) {
                // 펼치기
                windowContent.style.display = 'flex';
                gameWindow.style.height = '400px';
                gameWindow.classList.remove('collapsed');
            } else {
                // 접기
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
            }
        }
        
        function toggleInfoPanel2() {
            const panel = document.getElementById('infoPanel2');
            const content = document.getElementById('infoContent2');
            
            if (!panel) return;
            
            // 한번 닫혔으면 다시 열리지 않도록
            if (panel.dataset.closed === 'true') {
                return;
            }
            
            if (panel.classList.contains('minimized')) {
                panel.classList.remove('minimized');
                content.style.display = 'block';
                // right 속성 복원
                if (panel.dataset.originalRight) {
                    panel.style.right = panel.dataset.originalRight;
                    panel.style.left = 'auto';
                } else {
                    // 저장된 값이 없으면 기본값 사용
                    panel.style.right = '20px';
                    panel.style.left = 'auto';
                }
            } else {
                // 축소 - 오른쪽 위치 유지
                const computedStyle = window.getComputedStyle(panel);
                
                // originalRight가 없으면 현재 상태에서 저장
                if (!panel.dataset.originalRight) {
                    if (computedStyle.right !== 'auto') {
                        panel.dataset.originalRight = computedStyle.right;
                    } else if (computedStyle.left !== 'auto') {
                        // left를 right로 변환
                        const leftValue = parseInt(computedStyle.left) || 0;
                        const rightValue = window.innerWidth - leftValue - panel.offsetWidth;
                        panel.dataset.originalRight = rightValue + 'px';
                    } else {
                        panel.dataset.originalRight = '20px';
                    }
                }
                
                // right 속성 설정
                panel.style.right = panel.dataset.originalRight;
                panel.style.left = 'auto';
                panel.classList.add('minimized');
                content.style.display = 'none';
                // 닫힌 상태로 표시
                panel.dataset.closed = 'true';
            }
        }
        
        function initGame2Drag() {
            const gameWindow = document.getElementById('gameWindow2');
            const windowHeader = document.getElementById('windowHeader2');
            
            if (!gameWindow || !windowHeader) return;
            
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            const rect = gameWindow.getBoundingClientRect();
            xOffset = rect.left;
            yOffset = rect.top;

            windowHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            windowHeader.addEventListener('touchstart', dragStartTouch);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', dragEnd);

            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                isDragging = true;
                bringWindowToFront('gameWindow2');
                gameWindow.classList.add('dragging');
            }

            function dragStartTouch(e) {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
                isDragging = true;
                bringWindowToFront('gameWindow2');
                gameWindow.classList.add('dragging');
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragTouch(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                gameWindow.classList.remove('dragging');
            }

            function setTranslate(xPos, yPos, el) {
                el.style.left = xPos + 'px';
                el.style.top = yPos + 'px';
                el.style.transform = 'none';
            }
        }
        
        function closeInfoPanel() {
            document.getElementById('infoPanel').style.display = 'none';
        }
        
        function toggleInfoPanel() {
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('infoContent');
            
            if (!panel) return;
            
            // 한번 닫혔으면 다시 열리지 않도록
            if (panel.dataset.closed === 'true') {
                return;
            }
            
            if (panel.classList.contains('minimized')) {
                // 확장
                panel.classList.remove('minimized');
                content.style.display = 'block';
                // right 속성 복원
                if (panel.dataset.originalRight) {
                    panel.style.right = panel.dataset.originalRight;
                    panel.style.left = 'auto';
                } else {
                    // 저장된 값이 없으면 기본값 사용
                    panel.style.right = '20px';
                    panel.style.left = 'auto';
                }
            } else {
                // 축소 - 오른쪽 위치 유지
                const computedStyle = window.getComputedStyle(panel);
                
                // originalRight가 없으면 현재 상태에서 저장
                if (!panel.dataset.originalRight) {
                    if (computedStyle.right !== 'auto') {
                        panel.dataset.originalRight = computedStyle.right;
                    } else if (computedStyle.left !== 'auto') {
                        // left를 right로 변환
                        const leftValue = parseInt(computedStyle.left) || 0;
                        const rightValue = window.innerWidth - leftValue - panel.offsetWidth;
                        panel.dataset.originalRight = rightValue + 'px';
                    } else {
                        panel.dataset.originalRight = '20px';
                    }
                }
                
                // right 속성 설정
                panel.style.right = panel.dataset.originalRight;
                panel.style.left = 'auto';
                panel.classList.add('minimized');
                content.style.display = 'none';
                // 닫힌 상태로 표시
                panel.dataset.closed = 'true';
            }
        }
        
        function toggleWindowCollapse() {
            const gameWindow = document.getElementById('gameWindow1');
            const windowContent = gameWindow.querySelector('.window-content');
            const taskComplete = document.getElementById('taskComplete');
            
            // 업무 완료 후에는 다시 열리지 않도록
            if (taskComplete && window.getComputedStyle(taskComplete).display !== 'none') {
                return;
            }
            
            if (gameWindow.classList.contains('collapsed')) {
                // 펼치기
                windowContent.style.display = 'flex';
                gameWindow.style.height = '400px';
                gameWindow.classList.remove('collapsed');
            } else {
                // 접기
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
            }
        }
        
        function sendEmail() {
            const to = document.getElementById('emailTo').value.trim();
            const subject = document.getElementById('emailSubject').value.trim();
            const body = document.getElementById('emailBody').value;
            
            if (!to || !subject || !body.trim()) {
                alert('모든 필드를 입력해주세요.');
                return;
            }
            
            // 정답 (원문 내용)
            const correctTo = 'example@email.com';
            const correctSubject = '회의 안내';
            const correctBody = '안녕하세요, 디자인 검토 미팅이 2025년 12월 8일 오후 2시에 예정되어 있습니다. 감사합니다.';
            
            // 본문 비교 함수 (줄바꿈 제거 및 공백 정규화)
            function normalizeText(text) {
                return text
                    .replace(/\r\n/g, ' ')  // Windows 줄바꿈을 공백으로
                    .replace(/\r/g, ' ')    // Mac 줄바꿈을 공백으로
                    .replace(/\n/g, ' ')    // Unix 줄바꿈을 공백으로
                    .replace(/[ \t]+/g, ' ')  // 여러 공백을 하나로
                    .trim();
            }
            
            // 오타 검사
            const isToCorrect = to === correctTo;
            const isSubjectCorrect = subject === correctSubject;
            const isBodyCorrect = normalizeText(body) === normalizeText(correctBody);
            
            if (isToCorrect && isSubjectCorrect && isBodyCorrect) {
                alert('메일 보내기 성공');
                
                // 윈도우를 헤더만 남기고 접기
                const gameWindow = document.getElementById('gameWindow1');
                const windowContent = gameWindow.querySelector('.window-content');
                const taskComplete = document.getElementById('taskComplete');
                
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
                taskComplete.style.display = 'block';
                
                // 헤더 클릭 시 다시 펼치기
                const windowHeader = document.getElementById('windowHeader1');
                windowHeader.onclick = function(e) {
                    // 드래그 중이 아닐 때만 펼치기
                    if (!windowHeader.classList.contains('dragging')) {
                        toggleWindowCollapse();
                    }
                };
            } else {
                alert('오타가 있습니다. 다시 전송하세요.');
            }
        }
        
        function openOriginalModal(e) {
            e.preventDefault();
            // 원문 내용을 여기에 작성하세요
            const originalText = `받는 사람 
example@email.com
제목
회의 안내
내용
안녕하세요, 디자인 검토 미팅이 2025년 12월 8일 오후 2시에 예정되어 있습니다.
감사합니다.`;
            
            const modal = document.getElementById('originalModal');
            const modalContent = document.getElementById('originalModalContent');
            const modalBody = document.getElementById('originalModalBody');
            const modalHeader = document.getElementById('originalModalHeader');
            
            // "받는 사람", "제목", "내용"에 밑줄 적용
            const formattedText = originalText
                .replace(/받는 사람/g, '<span class="original-label">받는 사람</span>')
                .replace(/제목/g, '<span class="original-label">제목</span>')
                .replace(/내용/g, '<span class="original-label">내용</span>');
            
            modalBody.innerHTML = '<p style="white-space: pre-wrap; margin: 0;">' + formattedText + '</p>';
            modal.style.display = 'block';
            
            // 드래그 기능 초기화
            initOriginalModalDrag(modalContent, modalHeader);
        }
        
        function closeOriginalModal() {
            document.getElementById('originalModal').style.display = 'none';
        }
        
        function completeTask4() {
            alert('업무완료');
            
            const gameWindow = document.getElementById('gameWindow4');
            const windowContent = gameWindow.querySelector('.window-content');
            const taskComplete = document.getElementById('taskComplete4');
            
            if (gameWindow && windowContent && taskComplete) {
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
                taskComplete.style.display = 'block';
                
                // 헤더 클릭 시 다시 펼치기
                const windowHeader = document.getElementById('windowHeader4');
                if (windowHeader) {
                    windowHeader.onclick = function(e) {
                        if (!windowHeader.classList.contains('dragging')) {
                            toggleWindowCollapse4();
                        }
                    };
                }
            }
        }
        
        function initGame5Drag() {
            const gameWindow = document.getElementById('gameWindow5');
            const windowHeader = document.getElementById('windowHeader5');
            
            if (!gameWindow || !windowHeader) return;
            
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            const rect = gameWindow.getBoundingClientRect();
            xOffset = rect.left;
            yOffset = rect.top;

            windowHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            windowHeader.addEventListener('touchstart', dragStartTouch);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', dragEnd);

            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }
                isDragging = true;
                bringWindowToFront('gameWindow5');
                gameWindow.classList.add('dragging');
                windowHeader.classList.add('dragging');
            }

            function dragStartTouch(e) {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
                isDragging = true;
                bringWindowToFront('gameWindow5');
                gameWindow.classList.add('dragging');
                windowHeader.classList.add('dragging');
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragTouch(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;
                    const maxX = window.innerWidth - gameWindow.offsetWidth;
                    const maxY = window.innerHeight - gameWindow.offsetHeight;
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));
                    setTranslate(xOffset, yOffset, gameWindow);
                }
            }

            function dragEnd(e) {
                if (isDragging) {
                    initialX = currentX;
                    initialY = currentY;
                }
                isDragging = false;
                gameWindow.classList.remove('dragging');
                windowHeader.classList.remove('dragging');
            }
            
            function setTranslate(xPos, yPos, el) {
                el.style.left = xPos + 'px';
                el.style.top = yPos + 'px';
                el.style.transform = 'none';
            }
        }
        
        function initSlideDragDrop() {
            const slideContainer = document.getElementById('slideContainer');
            if (!slideContainer) return;
            
            const slideItems = slideContainer.querySelectorAll('.slide-item');
            let draggedElement = null;
            
            // 초기 순서 섞기
            const itemsArray = Array.from(slideItems);
            for (let i = itemsArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [itemsArray[i], itemsArray[j]] = [itemsArray[j], itemsArray[i]];
            }
            itemsArray.forEach(item => slideContainer.appendChild(item));
            
            // 번호 업데이트
            updateSlideNumbers();
            
            slideItems.forEach(function(item) {
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    // 드래그 시작 시 박스 형태 유지
                    this.style.transform = 'none';
                    this.style.position = 'relative';
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.innerHTML);
                });
                
                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    // 드래그 후 인라인 스타일 제거하여 박스 형태 유지
                    this.style.transform = '';
                    this.style.position = '';
                    this.style.top = '';
                    this.style.left = '';
                    this.style.width = '';
                    this.style.height = '';
                    this.style.opacity = '';
                    slideItems.forEach(function(slide) {
                        slide.classList.remove('drag-over');
                        // 모든 슬라이드 아이템의 인라인 스타일도 제거
                        slide.style.transform = '';
                        slide.style.position = '';
                        slide.style.top = '';
                        slide.style.left = '';
                    });
                });
                
                item.addEventListener('dragover', function(e) {
                    if (e.preventDefault) {
                        e.preventDefault();
                    }
                    e.dataTransfer.dropEffect = 'move';
                    if (this !== draggedElement) {
                        this.classList.add('drag-over');
                    }
                    return false;
                });
                
                item.addEventListener('dragenter', function(e) {
                    if (this !== draggedElement) {
                        this.classList.add('drag-over');
                    }
                });
                
                item.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });
                
                item.addEventListener('drop', function(e) {
                    if (e.stopPropagation) {
                        e.stopPropagation();
                    }
                    
                    if (draggedElement !== this) {
                        const allItems = Array.from(slideContainer.querySelectorAll('.slide-item'));
                        const draggedIndex = allItems.indexOf(draggedElement);
                        const targetIndex = allItems.indexOf(this);
                        
                        if (draggedIndex < targetIndex) {
                            slideContainer.insertBefore(draggedElement, this.nextSibling);
                        } else {
                            slideContainer.insertBefore(draggedElement, this);
                        }
                        
                        // 드롭 후 박스 형태 유지를 위해 스타일 리셋
                        draggedElement.style.transform = '';
                        draggedElement.style.position = '';
                        draggedElement.style.top = '';
                        draggedElement.style.left = '';
                        draggedElement.style.width = '';
                        draggedElement.style.height = '';
                        draggedElement.style.opacity = '';
                        
                        updateSlideNumbers();
                    }
                    
                    this.classList.remove('drag-over');
                    return false;
                });
                
                item.setAttribute('draggable', 'true');
            });
        }
        
        function updateSlideNumbers() {
            const slideContainer = document.getElementById('slideContainer');
            if (!slideContainer) return;
            
            const slideItems = slideContainer.querySelectorAll('.slide-item');
            slideItems.forEach(function(item, index) {
                const numberElement = item.querySelector('.slide-number');
                if (numberElement) {
                    numberElement.textContent = index + 1;
                }
            });
        }
        
        function completeTask5() {
            const slideContainer = document.getElementById('slideContainer');
            if (!slideContainer) return;
            
            const slideItems = slideContainer.querySelectorAll('.slide-item');
            const correctOrder = [
                '표지 — Project A Overview',
                '목차 — Agenda',
                '분석 결과 — Key Findings',
                '개선안 — Proposed Solution',
                '마무리 — Next Steps & Q/A'
            ];
            
            let isCorrect = true;
            slideItems.forEach(function(item, index) {
                const titleElement = item.querySelector('.slide-title');
                if (titleElement && titleElement.textContent.trim() !== correctOrder[index]) {
                    isCorrect = false;
                }
            });
            
            if (isCorrect) {
                alert('업무완료');
                
                const gameWindow = document.getElementById('gameWindow5');
                const windowContent = gameWindow.querySelector('.window-content');
                const taskComplete = document.getElementById('taskComplete5');
                
                if (gameWindow && windowContent && taskComplete) {
                    windowContent.style.display = 'none';
                    gameWindow.style.height = 'auto';
                    gameWindow.classList.add('collapsed');
                    taskComplete.style.display = 'block';
                    
                    // 헤더 클릭 시 다시 펼치기
                    const windowHeader = document.getElementById('windowHeader5');
                    if (windowHeader) {
                        windowHeader.onclick = function(e) {
                            if (!windowHeader.classList.contains('dragging')) {
                                toggleWindowCollapse5();
                            }
                        };
                    }
                }
            } else {
                alert('순서가 올바르지 않습니다. 다시 확인해주세요.');
            }
        }
        
        function toggleInfoPanel5() {
            const panel = document.getElementById('infoPanel5');
            const content = document.getElementById('infoContent5');
            
            if (!panel) return;
            
            // 한번 닫혔으면 다시 열리지 않도록
            if (panel.dataset.closed === 'true') {
                return;
            }
            
            if (panel.classList.contains('minimized')) {
                panel.classList.remove('minimized');
                content.style.display = 'block';
                // infoPanel5는 왼쪽에 위치
                if (panel.dataset.originalLeft) {
                    panel.style.left = panel.dataset.originalLeft;
                    panel.style.right = 'auto';
                } else {
                    panel.style.left = '20px';
                    panel.style.right = 'auto';
                }
            } else {
                const computedStyle = window.getComputedStyle(panel);
                
                if (!panel.dataset.originalLeft) {
                    if (computedStyle.left !== 'auto') {
                        panel.dataset.originalLeft = computedStyle.left;
                    } else {
                        panel.dataset.originalLeft = '20px';
                    }
                }
                
                panel.style.left = panel.dataset.originalLeft;
                panel.style.right = 'auto';
                panel.classList.add('minimized');
                content.style.display = 'none';
                // 닫힌 상태로 표시
                panel.dataset.closed = 'true';
            }
        }
        
        function toggleWindowCollapse5() {
            const gameWindow = document.getElementById('gameWindow5');
            const windowContent = gameWindow.querySelector('.window-content');
            const taskComplete = document.getElementById('taskComplete5');
            
            // 업무 완료 후에는 다시 열리지 않도록
            if (taskComplete && window.getComputedStyle(taskComplete).display !== 'none') {
                return;
            }
            
            if (gameWindow.classList.contains('collapsed')) {
                windowContent.style.display = 'flex';
                gameWindow.style.height = '500px';
                gameWindow.classList.remove('collapsed');
            } else {
                windowContent.style.display = 'none';
                gameWindow.style.height = 'auto';
                gameWindow.classList.add('collapsed');
            }
        }
        
        function initOriginalModalDrag(modalContent, modalHeader) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            // 모달의 초기 위치 설정 (화면 중앙)
            const rect = modalContent.getBoundingClientRect();
            if (xOffset === 0 && yOffset === 0) {
                xOffset = (window.innerWidth - rect.width) / 2;
                yOffset = (window.innerHeight - rect.height) / 2;
                setTranslate(xOffset, yOffset, modalContent);
            }

            modalHeader.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            // 터치 이벤트 지원 (모바일)
            modalHeader.addEventListener('touchstart', dragStartTouch);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', dragEnd);

            function dragStart(e) {
                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }

                isDragging = true;
                modalContent.classList.add('dragging');
            }

            function dragStartTouch(e) {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
                isDragging = true;
                modalContent.classList.add('dragging');
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }

                    xOffset = currentX;
                    yOffset = currentY;

                    // 화면 경계 내에서만 이동하도록 제한
                    const maxX = window.innerWidth - modalContent.offsetWidth;
                    const maxY = window.innerHeight - modalContent.offsetHeight;
                    
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));

                    setTranslate(xOffset, yOffset, modalContent);
                }
            }

            function dragTouch(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;

                    xOffset = currentX;
                    yOffset = currentY;

                    const maxX = window.innerWidth - modalContent.offsetWidth;
                    const maxY = window.innerHeight - modalContent.offsetHeight;
                    
                    xOffset = Math.max(0, Math.min(xOffset, maxX));
                    yOffset = Math.max(0, Math.min(yOffset, maxY));

                    setTranslate(xOffset, yOffset, modalContent);
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                modalContent.classList.remove('dragging');
            }

            function setTranslate(xPos, yPos, el) {
                el.style.left = xPos + 'px';
                el.style.top = yPos + 'px';
                el.style.transform = 'none';
            }
        }
    </script>
    <script>
        // intro.html에서 온 경우 텍스트 순차적으로 표시
        window.addEventListener('DOMContentLoaded', function() {
            const introShown = sessionStorage.getItem('introShown');
            const showIntroText = sessionStorage.getItem('showIntroText');
            
            if (introShown === 'true' && showIntroText === 'true') {
                // 텍스트 순차적으로 표시
                showIntroTexts();
                sessionStorage.removeItem('showIntroText');
            } else if (introShown === 'true') {
                const mainContainer = document.getElementById('mainContainer');
                const gamesWrapper = document.getElementById('gamesWrapper');
                if (mainContainer && gamesWrapper) {
                    mainContainer.style.display = 'none';
                    gamesWrapper.style.display = 'block';
                    enterGames();
                }
            }
        });
        
        function showIntroTexts() {
            const introTextContainer = document.getElementById('introTextContainer');
            const introText = document.getElementById('introText');
            const startBtn = document.getElementById('startBtn');
            
            if (!introTextContainer || !introText) return;
            
            introTextContainer.style.display = 'block';
            
            const texts = [
                '오늘도 회사에서 할 일들이 쌓였나요?',
                '그래서 우리는 종종 여러 일을 동시에 처리해야 합니다',
                '과연 <u>멀티태스킹</u>이 효율적일까요?',
                '직접 체험해보세요'
            ];
            
            let currentIndex = 0;
            
            function showNextText() {
                if (currentIndex >= texts.length) {
                    // 모든 텍스트가 끝난 후 버튼 표시
                    setTimeout(() => {
                        if (startBtn) {
                            startBtn.style.opacity = '1';
                        }
                    }, 500);
                    return;
                }
                
                // 이전 텍스트 사라지기
                introText.style.opacity = '0';
                
                setTimeout(() => {
                    // 새 텍스트 설정 (HTML 지원)
                    introText.innerHTML = texts[currentIndex];
                    // 새 텍스트 나타나기
                    setTimeout(() => {
                        introText.style.opacity = '1';
                    }, 100);
                    
                    currentIndex++;
                    
                    // 다음 텍스트로 (각 텍스트는 2초간 표시)
                    setTimeout(() => {
                        showNextText();
                    }, 2000);
                }, 300);
            }
            
            // 첫 번째 텍스트 시작 (파동이 끝나면 바로 표시)
            setTimeout(() => {
                showNextText();
            }, 100);
        }
        
        // 타이머 변수
        let timerInterval = null;
        let timerSeconds = 70;
        
        function startTimer() {
            const timerText = document.getElementById('timerText');
            if (!timerText) return;
            
            // 기존 타이머가 있으면 초기화
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timerSeconds = 70;
            updateTimerDisplay();
            
            timerInterval = setInterval(function() {
                timerSeconds--;
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    showTimerTimeout();
                    showTimerEndModal();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const timerText = document.getElementById('timerText');
            if (!timerText) return;
            
            // 00:00:60 형식 (시:분:초가 아니라 분:초:초 형식으로 해석)
            // 60초부터 시작해서 0초까지
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const formattedMinutes = String(minutes).padStart(2, '0');
            const formattedSeconds = String(seconds).padStart(2, '0');
            
            // 00:00:60 형식으로 표시 (시:분:초)
            timerText.textContent = `00:${formattedMinutes}:${formattedSeconds}`;
        }
        
        function showTimerTimeout() {
            const timerText = document.getElementById('timerText');
            if (timerText) {
                timerText.textContent = '시간초과';
                timerText.classList.add('timer-timeout');
            }
        }
        
        function showTimerEndModal() {
            const modal = document.getElementById('timerEndModal');
            const timerEndText = document.querySelector('.timer-end-text');
            const restartBtn = document.getElementById('restartBtn');
            if (!modal || !timerEndText) return;
            
            // 모달 표시
            modal.style.display = 'flex';
            
            // 텍스트 배열
            const messages = [
                '한번에 여러가지 일을 해보니 어떠신가요?',
                '바쁘게 움직였지만, 집중이 자주 끊기지 않았나요?',
                '멀티태스킹은 능력처럼 보이지만, 실제로는 효율을 떨어뜨리기도 합니다.'
            ];
            
            let currentIndex = 0;
            
            // 첫 번째 메시지 표시
            timerEndText.textContent = messages[currentIndex];
            
            // 3초마다 다음 메시지로 변경
            const messageInterval = setInterval(function() {
                currentIndex++;
                if (currentIndex < messages.length) {
                    timerEndText.textContent = messages[currentIndex];
                } else {
                    clearInterval(messageInterval);
                    // 모든 메시지가 끝난 후 버튼 표시
                    if (restartBtn) {
                        setTimeout(function() {
                            restartBtn.style.display = 'inline-block';
                            restartBtn.style.opacity = '0';
                            setTimeout(function() {
                                restartBtn.style.transition = 'opacity 0.5s ease';
                                restartBtn.style.opacity = '1';
                            }, 50);
                        }, 500);
                    }
                }
            }, 3000);
        }
        
        function restartGame() {
            // 페이지 새로고침하여 게임을 처음부터 다시 시작
            location.reload();
        }
    </script>
</body>
</html>